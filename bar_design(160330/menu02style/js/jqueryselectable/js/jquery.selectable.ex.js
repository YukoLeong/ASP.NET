/*
	title: jQuery.selectable.js
	required: jQuery(tested on 1.3.2)
	copy: Copyright 2009 nori (norimania@gmail.com)
	license: MIT
	author: 5509 - http://moto-mono.net
	archive: http://moto-mono.net/2008/09/14/jqueryselectable.html
	update: 2009-07-30 01:30
	date: 2008-09-14 02:34
 */

(function(a){a.selectable=function(r,b,d){var B=a.extend({style:"selectable",set:"show",out:"hide",inDuration:"normal",outDuration:"normal",opacity:1,pos:0},b),E=a(r),s={id:E.attr("id"),cl:E.attr("class")},t=(a("optgroup",E).length>0)?true:false;if(t){var f=a("optgroup",E);var m=new Array();for(var x=0;x<f.length;x++){m[x]=a("option",f[x])}}else{var m=a("option",E)}var n=a(document.createElement("a")),l=a(document.createElement("span")),y=(B.style.match(/simpleBox/))?"sBox":"sctble";n.append(l).attr({id:s.id+"_dummy",href:"#"}).addClass("sctble_display").addClass(y).addClass(s.cl).insertAfter(r);E.hide();function e(c){var i=n.offset();c.css({top:i.top+n.height()*1.3+B.pos,left:i.left})}var A=a(document.createElement("div"));A.attr({id:s.id+"_mat"}).addClass(y).addClass(s.cl);var F=function(k,j){var c=a(document.createElement("a"));a(j).append(c);c.text(k.text()).attr({href:"#"+encodeURI(k.text()),name:k.val()});if(k.is(":selected")){l.text(k.text());c.addClass("selected")}if(k.hasClass("br")){var i=a(document.createElement("br"));i.insertAfter(c)}};if(t){var w=a(document.createElement("dl"));for(var v=0;v<f.length;v++){var o=a(document.createElement("dt"));o.text(a(f[v]).attr("label"));var D=a(document.createElement("dd"));for(var u=0;u<m[v].length;u++){F(a(m[v][u]),D)}w.append(o).append(D)}A.append(w).addClass("optg")}else{var q=document.createElement("p");for(var v=0;v<m.length;v++){F(a(m[v]),q)}A.append(q).addClass("nooptg")}a("body").append(A);if(document.all&&typeof document.body.style.maxHeight=="undefined"){if(B.height<A.height()){A.css("height",B.height)}}else{A.css("maxHeight",B.height)}A.addClass("sctble_mat").css({position:"absolute",zIndex:1000,display:"none"});a("*:first-child",A).addClass("first-child");a("*:last-child",A).addClass("last-child");var g=false;var h=function(c){if(c==A){g=false}switch(B.out){case"slideUp":c.slideUp(B.outDuration);break;case"fadeOut":c.fadeOut(B.outDuration);break;default:c.hide();break}};var z=true;var C=function(j){g=true;h(a(".sctble_mat"));switch(B.set){case"slideDown":A.slideDown(B.inDuration).css("opacity",B.opacity);break;case"fadeIn":A.css({display:"block",opacity:0}).fadeTo(B.inDuration,B.opacity);break;default:A.show().css("opacity",B.opacity);break}var i=isNaN(B.inDuration)?null:(B.inDuration+10);if(i==null){if(B.inDuration.match(/slow/)){i=610}else{if(B.inDuration.match(/normal/)){i=410}else{i=210}}}var c=setInterval(function(){a("a.selected",A).focus();clearInterval(c)},i)};n.click(function(c){if(g){a("a.sctble_focus").removeClass("sctble_focus");h(A);return false;}e(A);a(this).addClass("sctble_focus");a("a.sctble_focus").not(this).removeClass("sctble_focus");C(this);c.stopPropagation();return false}).keyup(function(c){if(z){e(A);C(this);c.stopPropagation()}else{z=true}});A.click(function(c){c.stopPropagation()});a("body,a").not("a.sctble_display").click(function(c){a("a.sctble_focus").removeClass("sctble_focus");h(A)}).not("a").keyup(function(c){if(c.keyCode==27){a("a.sctble_focus").removeClass("sctble_focus");z=false;n.blur();h(A)}});a("a",A).click(function(){var c=a(this);l.text(decodeURI(c.attr("href").split("#")[1]));a('option[value="'+c.attr("name")+'"]',r).attr("selected","selected");a(".selected",A).removeClass("selected");c.addClass("selected");n.removeClass("sctble_focus");z=false;h(A);if(d){d()}n.focus();return false});a('label[for="'+s.id+'"]').click(function(c){e(A);n.addClass("sctble_focus");a("a.sctble_focus").not(n).removeClass("sctble_focus");C(n);c.stopPropagation();return false})};a.fn.selectable=function(b,c){a(this).each(function(){a.selectable(this,b,c)})}})(jQuery);